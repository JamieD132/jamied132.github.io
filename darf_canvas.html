<!doctype html>
<head>
  <title>Darflen Canvas Backups</title>
</head>
<body>
  <h2>Current Canvas</h2>
  <canvas id="current_canvas" width="128" height="128"></canvas>
  <script src="https://cdn.socket.io/4.8.1/socket.io.min.js" crossorigin="anonymous" type="text/javascript"></script>
  <script>
    var hex = /^#(?:[0-9a-fA-F]{3}){1,2}$/;
    const socket = io("wss://api.darflen.com/canvas", {
        path: "/ws/",
        transports: ["websocket", "polling"],
        withCredentials: true,
    });
    socket.on("connect", () => {
        socket.emit("request_canvas");
    });
    function draw(data){
      var canvas = document.querySelector('canvas');
      var ctx = canvas.getContext('2d');
      for(let y = 0; y< grid_size;y++){
        for(let x=0;x<grid_size;x++){
          ctx.fillStyle=hex.test(data[y*grid_size+x])?data[y*grid_size+x]:"#ffffff";
          ctx.fillRect(x,y,1,1);
        }
      }
    }
    grid_size = 128;
    grid_data = new Array(grid_size*grid_size);
    socket.on("update_bulk", (stuff) => {
        for (const { x, y, data } of stuff) {
            grid_data[y * grid_size + x] = data.color;
        }
        draw(grid_data);
    });
  </script>
  <style>
    canvas,img{
      image-rendering:pixelated;
    }
  </style>
</body>
